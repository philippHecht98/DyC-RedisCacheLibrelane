sequenceDiagram
    participant CPU as AXI Master (CPU)
    participant AW as Write Address Channel
    participant W as Write Data Channel
    participant B as Write Response Channel
    participant FSM as Interface FSM
    participant CTRL as Cache Controller
    participant AR as Read Address Channel
    participant R as Read Data Channel
    
    Note over CPU,R: Complete Cache GET Operation with AXI4-Lite
    
    rect rgb(200, 220, 240)
        Note over CPU,B: Phase 1: Write Key Register (0x04)
        CPU->>AW: awaddr=0x04, awvalid=1
        AW-->>CPU: awready=1 (cycle 2)
        CPU->>W: wdata=KEY, wvalid=1
        W-->>CPU: wready=1 (cycle 3)
        W->>B: Write completes
        B->>CPU: bvalid=1, bresp=OKAY
        CPU-->>B: bready=1
    end
    
    rect rgb(220, 240, 200)
        Note over CPU,B: Phase 2: Write Operation Register (0x00)
        CPU->>AW: awaddr=0x00, awvalid=1
        AW-->>CPU: awready=1 (cycle 2)
        CPU->>W: wdata=GET_OP, wvalid=1
        W-->>CPU: wready=1 (cycle 3)
        W->>FSM: op_written pulse (cycle 3)
        Note over FSM: State: IDLE → EXECUTE
        W->>B: Write completes
        B->>CPU: bvalid=1, bresp=OKAY
        CPU-->>B: bready=1
    end
    
    rect rgb(255, 240, 200)
        Note over FSM,CTRL: Phase 3: Cache Operation Execution
        FSM->>FSM: State: EXECUTE
        FSM->>CTRL: start_out=1 (1 cycle pulse)
        FSM->>FSM: State: EXECUTE → WAIT
        Note over CTRL: Controller processes<br/>cache lookup
        CTRL-->>CTRL: Memory access
        CTRL-->>CTRL: Tag comparison
        CTRL->>FSM: done_in=1, hit_in=1,<br/>result_value_in=DATA
        FSM->>FSM: Latch results into<br/>result_regs[]
        FSM->>FSM: State: WAIT → COMPLETE<br/>status_done=1
    end
    
    rect rgb(240, 200, 220)
        Note over CPU,R: Phase 4: Poll Status Register
        loop Poll until done
            CPU->>AR: araddr=STATUS, arvalid=1
            AR-->>CPU: arready=1 (cycle 2)
            AR->>R: Address decoded
            R->>CPU: rdata=status_reg, rvalid=1
            CPU-->>R: rready=1
            Note over CPU: Check status_done bit
        end
    end
    
    rect rgb(220, 200, 240)
        Note over CPU,R: Phase 5: Read Result Value
        CPU->>AR: araddr=RESULT_BASE, arvalid=1
        AR-->>CPU: arready=1 (cycle 2)
        AR->>R: Address decoded
        R->>CPU: rdata=result_regs[0], rvalid=1
        CPU-->>R: rready=1
        
        Note over CPU: If multi-word result,<br/>read additional registers
        
        CPU->>AR: araddr=RESULT_BASE+4, arvalid=1
        AR-->>CPU: arready=1
        AR->>R: Address decoded
        R->>CPU: rdata=result_regs[1], rvalid=1
        CPU-->>R: rready=1
    end
    
    rect rgb(200, 240, 240)
        Note over CPU,R: Phase 6: Read Hit Status & Index
        CPU->>AR: araddr=RESULT_INDEX, arvalid=1
        AR-->>CPU: arready=1
        AR->>R: Address decoded
        R->>CPU: rdata=result_index_reg, rvalid=1
        CPU-->>R: rready=1
    end
    
    Note over CPU,R: Transaction Complete - Ready for Next Operation
